@inherits LayoutComponentBase
@code {
    private SiteSettingsViewModel? siteSettings;
    private MarkupString? introText;
    private string? contactEmail;
    private string? copyrightText;
    private bool isMenuOpen = false;
    private bool navigationHasItems = false;

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            siteSettings = UmbracoHelperService.GetSiteSettings();
            if (siteSettings is not null)
            {
                introText = new MarkupString(siteSettings.IntroText ?? string.Empty);
                contactEmail = siteSettings.ContactEmail;
                copyrightText = siteSettings.Copyright ?? string.Empty;
                navigationHasItems = siteSettings?.Navigation?.Any() ?? false;
            }
            StateHasChanged();
        }
    }

    private void CloseMenu()
    {
        isMenuOpen = false;
        StateHasChanged();
    }
}

<div class="main-layout flex flex-col min-h-screen">
    <div class="grid grid-cols-12 gap-0">
        <header class="col-span-12 col-start-1 lg:col-span-8 lg:col-start-3 p-4">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-1 items-center relative">
                @if (introText.HasValue)
                {
                    <div class="col-span-1">
                        @introText
                    </div>
                }
                @if (!string.IsNullOrEmpty(contactEmail))
                {
                    <div class="col-span-1 hidden md:flex items-center justify-center md:justify-end">
                        <a rel="noopener noreferrer" target="_blank" aria-label="Say hello @contactEmail" class="text-black"
                           href="mailto:@contactEmail">
                            Get in touch <br>
                            <div class="underline underline-offset-12">@contactEmail</div>
                        </a>
                    </div>
                }
                <div class="absolute top-0 right-0 p-4 md:hidden">
                    <label class="relative z-40 cursor-pointer px-3 py-6" for="mobile-menu">
                        <input class="peer hidden" type="checkbox" id="mobile-menu" @bind="isMenuOpen" />
                        <span class="hamburger-icon @(isMenuOpen ? "open" : "") relative z-50 block h-[1px] w-7 bg-transparent content-[''] before:absolute before:top-[-0.35rem] before:z-50 before:block before:h-full before:w-full before:transition-all before:duration-200 before:ease-out before:content-[''] after:absolute after:right-0 after:bottom-[-0.35rem] after:block after:h-full after:w-full after:transition-all after:duration-200 after:ease-out after:content-[''] @(isMenuOpen ? "before:bg-white after:bg-white" : "before:bg-black after:bg-black") before:peer-checked:top-0 before:peer-checked:w-full before:peer-checked:rotate-45 before:peer-checked:transform after:peer-checked:bottom-0 after:peer-checked:w-full after:peer-checked:-rotate-45 after:peer-checked:transform"
                              style="background-color: transparent;">
                        </span>
                        <span class="fixed inset-0 z-40 hidden h-full w-full bg-black/50 backdrop-blur-sm peer-checked:block">
                            &nbsp;
                        </span>
                        <span class="mobile-menu fixed top-0 right-0 z-40 h-full w-full translate-x-full overflow-y-auto overscroll-y-none transition duration-500 peer-checked:translate-x-0">
                            <span class="float-right min-h-full w-[85%] bg-black px-6 pt-12 shadow-2xl">
                                @if (siteSettings is not null && navigationHasItems)
                                {
                                    <MenuComponent Navigation="siteSettings.Navigation" OnCloseMenu="CloseMenu" />
                                }
                            </span>
                        </span>
                    </label>
                </div>
                @if (siteSettings is not null && navigationHasItems)
                {
                    <nav class="col-span-3 hidden md:flex flex-row justify-center md:justify-end space-x-4">
                        @foreach (var navItem in siteSettings.Navigation)
                        {
                            <a target="@navItem.Target" href="@navItem.Url" class="text-black">@navItem.Name</a>
                        }
                    </nav>
                }
            </div>
        </header>

        <main class="col-span-12 col-start-1 lg:col-span-8 lg:col-start-3">
            @Body
        </main>

        <footer class="col-span-12 col-start-1 lg:col-span-8 lg:col-start-3 sticky bottom-0 p-4 text-black">
            <p>&copy; @copyrightText @DateTime.UtcNow.Year</p>
        </footer>
    </div>
</div>